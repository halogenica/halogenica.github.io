<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Adding Underglow to DZ65RGB and QMK - Halogenica</title>
  <meta name="description" content="I recently built a DZ65RGB keyboard to replace my TADA68 and I&rsquo;ve been thrilled with it, but it is lacking one major feature: it has no underglow support. So I undertook a challenge to add high quality LEDs to the underside of my favorite TADA68 case, powered through the DZ65RGB PCB, and controlled by the keyboard microcontroller (an STM32 ARM Cortex) running the QMK firmware. While underglow is a configuration setting in QMK for many AVR microcontrollers, it is not supported out of the box for the STM32 ARM microcontroller, and it conflicts with the individually addressable RGB LEDs. This is a detailed tutorial on the hardware and software required to enable additional dimmable lights to any STM32 keyboard with full production-quality integration.">
  <meta name="author" content="Michael Romero"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Halogenica",
    
    "url": "https:\/\/halogenica.net"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/halogenica.net"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/halogenica.net",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/halogenica.net\/hardware\/adding-underglow-to-dz65rgb-and-qmk\/",
          "name": "Adding underglow to d z65 r g b and q m k"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Mike"
  },
  "headline": "Adding Underglow to DZ65RGB and QMK",
  "description" : "I recently built a DZ65RGB keyboard to replace my TADA68 and I\x26rsquo;ve been thrilled with it, but it is lacking one major feature: it has no underglow support. So I undertook a challenge to add high quality LEDs to the underside of my favorite TADA68 case, powered through the DZ65RGB PCB, and controlled by the keyboard microcontroller (an STM32 ARM Cortex) running the QMK firmware. While underglow is a configuration setting in QMK for many AVR microcontrollers, it is not supported out of the box for the STM32 ARM microcontroller, and it conflicts with the individually addressable RGB LEDs. This is a detailed tutorial on the hardware and software required to enable additional dimmable lights to any STM32 keyboard with full production-quality integration.\n",
  "inLanguage" : "en",
  "wordCount":  5230 ,
  "datePublished" : "2019-10-03T00:00:00",
  "dateModified" : "2019-10-03T00:00:00",
  "image" : "https:\/\/halogenica.net",
  "keywords" : [ "Hardware, Microcontroller, Keyboard" ],
  "mainEntityOfPage" : "https:\/\/halogenica.net\/hardware\/adding-underglow-to-dz65rgb-and-qmk\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/halogenica.net",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/halogenica.net",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Adding Underglow to DZ65RGB and QMK" />
<meta property="og:description" content="I recently built a DZ65RGB keyboard to replace my TADA68 and I&rsquo;ve been thrilled with it, but it is lacking one major feature: it has no underglow support. So I undertook a challenge to add high quality LEDs to the underside of my favorite TADA68 case, powered through the DZ65RGB PCB, and controlled by the keyboard microcontroller (an STM32 ARM Cortex) running the QMK firmware. While underglow is a configuration setting in QMK for many AVR microcontrollers, it is not supported out of the box for the STM32 ARM microcontroller, and it conflicts with the individually addressable RGB LEDs. This is a detailed tutorial on the hardware and software required to enable additional dimmable lights to any STM32 keyboard with full production-quality integration.">
<meta property="og:url" content="https://halogenica.net/hardware/adding-underglow-to-dz65rgb-and-qmk/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Halogenica" />

  <meta name="twitter:title" content="Adding Underglow to DZ65RGB and QMK" />
  <meta name="twitter:description" content="I recently built a DZ65RGB keyboard to replace my TADA68 and I&rsquo;ve been thrilled with it, but it is lacking one major feature: it has no underglow support. So I undertook a challenge to add high â€¦">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@halogenica" />
  <meta name="twitter:creator" content="@halogenica" />
  <link href='https://halogenica.net/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.58.3" />
  <link rel="alternate" href="https://halogenica.net/index.xml" type="application/rss+xml" title="Halogenica"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://halogenica.net/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://halogenica.net/css/highlight.min.css" /><link rel="stylesheet" href="https://halogenica.net/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



<link rel="stylesheet" href="https://halogenica.net/css/custom.css" />


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://halogenica.net">Halogenica</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Games" href="https://halogenica.net/games/">Games</a>
            </li>
          
        
          
            <li>
              <a title="Graphics" href="https://halogenica.net/graphics/">Graphics</a>
            </li>
          
        
          
            <li>
              <a title="Tools" href="https://halogenica.net/tools/">Tools</a>
            </li>
          
        
          
            <li>
              <a title="Software" href="https://halogenica.net/software/">Software</a>
            </li>
          
        
          
            <li>
              <a title="Hardware" href="https://halogenica.net/hardware/">Hardware</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="https://halogenica.net/tags">Tags</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://halogenica.net/about">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1 
      
         
          data-img-src-1="/img/hardware/adding-underglow-to-dz65rgb-and-qmk/bigimg.jpg" 
         
         
      ></div>
  

  <header class="header-section has-img">
    
      <div class="intro-header big-img">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
                <h1>Adding Underglow to DZ65RGB and QMK</h1>
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on October 3, 2019
  
  
  
  
  
</span>


                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;"></span>
      </div>
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Adding Underglow to DZ65RGB and QMK</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on October 3, 2019
  
  
  
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>I recently built a <a href="https://halogenica.net/hardware/custom-keyboard-dz65rgb/">DZ65RGB</a> keyboard to replace my <a href="https://halogenica.net/hardware/custom-keyboard-tada68/">TADA68</a> and I&rsquo;ve been thrilled with it, but it is lacking one major feature: it has no underglow support. So I undertook a challenge to add high quality LEDs to the underside of my favorite TADA68 case, powered through the DZ65RGB PCB, and controlled by the keyboard microcontroller (an STM32 ARM Cortex) running the QMK firmware. While underglow is a configuration setting in QMK for many AVR microcontrollers, it is not supported out of the box for the STM32 ARM microcontroller, and it conflicts with the individually addressable RGB LEDs. This is a detailed tutorial on the hardware and software required to enable additional dimmable lights to any STM32 keyboard with full production-quality integration.</p>

<video loop autoplay muted playsinline>
    <source src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/underglow.mp4">
</video>

<h2 id="getting-started">Getting Started</h2>

<p>I have a lofty goal of replacing or improving the LED functionality of the TADA68, with an extremely high quality integration. This means a number of single color, non-addressable LEDs, with dimming capability, and the appropriate keycodes to control the lights with hotkeys. Let me break down all the pieces that need to be solved so we can tackle them one at a time:</p>

<h4 id="how-to-control-the-leds">How to Control the LEDs</h4>

<p>We know we want to control the LEDs with QMK, and this isn&rsquo;t the sort of thing that can simply be &ldquo;configured&rdquo; with user-facing QMK tools. We need to be able to build QMK from source, and add new functionality to these extra pins on the keyboard. Particularly because we&rsquo;re tapping into pins that are not already configured in QMK, and because QMK lacks some support for backlight/underglow on STM32 ARM microcontrollers, and because we need to work around the conflicts with RGB LED backlights and LED underlights, we need to write some code for QMK to initialize and control the pins appropriately.</p>

<h4 id="how-to-address-the-leds">How to Address the LEDs</h4>

<p>Although these pins are labeled on the PCB, we can&rsquo;t be sure the labels map to the same pin names within QMK. Moreover, for advanced features such as making the LEDs dimmable, we need to know how to enable <a href="https://www.arduino.cc/en/tutorial/PWM">PWM</a> on these pins. This will require identifying the microcontroller, finding the spec sheet, and understanding the available functionality for these pins.</p>

<h4 id="how-to-wire-the-leds">How to Wire the LEDs</h4>

<p>I know at a minimum I need the LEDs to draw power from the DZ65RGB PCB. This would be very straight forward, and simply requires tapping into the power lines on the USB port and adding the appropriate resistors for the LED voltage. However the real goal is to control the behavior of the LEDs using QMK, which means I would need to find an appropriate pin on the microcontroller to tap into. Upon inspecting the PCB, I found that there are several pins broken out on the PCB that don&rsquo;t seem to have a use on the DZ65RGB. Let&rsquo;s see if we can use one of those.</p>

<h4 id="how-to-mount-the-leds">How to Mount the LEDs</h4>

<p>The TADA68 has 4 white LEDs pointing down towards the desk, 2 on the left and 2 on the right side of the keyboard. There are holes in the case to allow light out. The DZ65RGB does not have these LEDs, most likely because the footprint for each switch on the PCB is much larger, and the RGB LED backlights are physically in the way of where the underglow LEDs were mounted on the TADA68. Fortunately because the holes already exist in the case, it is easier to devise a physical mounting location - LEDs can be packaged small enough to fit easily in the case and they can be glued into place, or an appropriate strip light can be mounted in a notch outside of the case.</p>

<h2 id="building-qmk">Building QMK</h2>

<h3 id="setting-up-the-environment">Setting up the Environment</h3>

<p>First, you can follow the <a href="https://docs.qmk.fm/#/newbs_getting_started">Getting Started Guide</a> to setup an environment that can build QMK. I&rsquo;m running Windows 10, so per the instructions I had to install <a href="https://www.msys2.org/">msys2</a> to create the build environment. I chose to install the 64 bit version.</p>

<p>When setting up the environment, clone the correct repository for your board. In the case of my DZ65RGB PCB, <a href="https://github.com/moyi4681/qmk_firmware">DZtech maintains a repository</a>. But most keyboards are also available in the official <a href="https://github.com/qmk/qmk_firmware">QMK Firmware GitHub</a>, which is what I ultimately used.</p>

<p>From the directory where I synced the DZTech QMK repository, running in MinGW (installed by MSYS) I ran <code>util/qmk_install.sh</code> and agreed to install all packages. It then asked which USB drivers to install, and I recommend pressing <code>A</code> to install all supported drivers. I originally connected my DZ65RGB board and chose <code>C</code> to install drivers for all connected keyboards, but I could not tell if this detected or installed anything for the DZ65RGB board and I think it may have caused me trouble down the line. I then agreed to install the AVR tool chain, which may not be necessary but I may program AVR boards in the future. Then I agreed to install the ARM tool chain, which certainly <em>is</em> needed. Finally, I agreed to add the qmk script to the end of my MSYS bash file and restarted MSYS.</p>

<p>I also received the error message <code>WARNING: Some git sub-modules are out of date or modified, please consider running: make git-submodule</code> the first time I tried to compile. This is very straightforward, just run <code>make git-submodule</code>. This will initialize the necessary git submodules.</p>

<h3 id="compiling-qmk">Compiling QMK</h3>

<p>Finally after the environment was set up, I was able to build the firmware using <code>make dztech/dz65rgb:default</code> which appeared to complete successfully. If you end up in a bad state (which happened to me occasionally), you can always start a build fresh after running <code>make clean</code>, and you can do a full rebuild by adding <code>clean</code> to the end of the build command, e.g. <code>make dztech/dz65rgb:default clean</code></p>


<link rel="stylesheet" href="https://halogenica.net/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/vscode.png" alt="Firmware Compiled"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/vscode.png" itemprop="contentUrl"></a>
  </figure>
</div>


<h3 id="flashing-the-firmware">Flashing the Firmware</h3>

<p>To make sure everything worked correctly, I flashed the keyboard with the new firmware I built and verified that keys were working as expected. I put my keyboard in the bootloader mode by holding ESC while plugging the USB in. To make firmware installation easy, QMK develops a tool called <a href="https://github.com/qmk/qmk_toolbox/releases">QMK Toolbox</a>. I installed the portable version <code>0.0.10</code>, and unfortunately it was <a href="https://github.com/qmk/qmk_toolbox/issues/57#issuecomment-442669898">incorrectly flagged as a trojan by windows defender</a>, so I had to specifically allow this file in windows defender. After installing the toolbox, I received an error stating <code>No DFU capable USB device available</code>&hellip;</p>

<p>The kbdfans site instructs you to install the WinUSB driver via <a href="https://zadig.akeo.ie/">Zadig</a> (I have version WinUSB (v6.1.7600.16385)). To do this, run Zadig, select the <code>Options</code> menu, and be sure to choose <code>List All Devices</code>. Select the <code>STM32 BOOTLOADER</code> from the dropdown (this may only be visible when the device is connected in the bootloader mode as described above). Then select the WinUSB driver, and choose <code>Replace Driver</code>. This is what was required to fix the <code>No DFU...</code> error.  Once I reloaded the QMK Toolbox, I saw a notification that my keyboard was detected in the output window, which read <code>STM32 device connected: STM Device in DFU Mode</code>. I was able to open my firmware (<code>...\qmk_firmware\dztech_dz65rgb_default.bin</code> in my case) and press <code>Flash</code> - you can safely ignore the other dropdowns and buttons. After pressing <code>Flash</code>, QMK Toolbox should upload your firmware onto the DZ65RGB and the PCB will reboot with the RGB LEDs shifting through the colors of the rainbow. Congratulations on getting this far!</p>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/QMKToolbox.png" alt="Firmware Uploaded"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/QMKToolbox.png" itemprop="contentUrl"></a>
  </figure>
</div>


<h2 id="simple-underglow">Simple Underglow</h2>

<p>Now, let&rsquo;s add underglow support. This is where things get a little tricky. The QMK firmware normally supports underglow via the <a href="https://docs.qmk.fm/#/feature_rgblight">RGBLIGHT</a> feature. However, there are two downsides to this feature with the DZ65RGB: the function keys controlling the RGB lights conflict with the <a href="https://docs.qmk.fm/#/feature_rgb_matrix">RGB_MATRIX</a> feature, and the TADA68 case I&rsquo;m dropping this board into typically has only 4 white underglow lights so I don&rsquo;t plan on using RGB LEDs. Instead, I will be using single color LEDs, and control them with the <a href="https://docs.qmk.fm/#/feature_backlight">BACKLIGHT</a> feature, which will work great for LEDs of a single color, and will have unique function keys to control the LEDs. My understanding is this is not what the Backlight feature was intended for, but it should work, and avoid the conflicts with the RGB_MATRIX! In the <code>...\qmk_firmware\keyboards\dztech\dz65rgb\rules.mk</code> file I enabled the BACKLIGHT feature by modifying the line <code>BACKLIGHT_ENABLE = yes</code>.</p>

<h3 id="identify-the-microcontroller">Identify the Microcontroller</h3>

<p>Up to this point I&rsquo;ve mentioned the DZ65RGB uses an ARM chip, but I didn&rsquo;t find this documented anywhere. Instead I had carefully inspect the PCB and take some very close up pictures to identify the microcontroller. This is also how I identified the breakout pins and followed the traces to pins A1, A2, A3, A4, and A5. I was able to read the chip and found the type of microcontroller: the <a href="https://www.st.com/en/microcontrollers-microprocessors/stm32f303.html">STM32F303</a>.</p>




<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4768.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4768.jpg" alt="The very convenient available breakout pins"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4768.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4770.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4770.jpg" alt="The STM32F303 Microcontroller"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4770.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4772.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4772.jpg" alt="The logic area of the PCB"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4772.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


</div>


<p>I was then able to find the <a href="https://www.st.com/resource/en/datasheet/stm32f303cb.pdf">spec sheet for the microcontroller</a>, which was crucial to understand for this mod. I cross referenced it and found (on page 32) that the pinout labels on the PCB indeed lines up with PA1, PA2, PA3, PA4, and PA5 in the spec sheet, which are GPIO pins. Referencing section 3.10 on page 20, I can see the statement &ldquo;All GPIOs are high current capable except for analog inputs&rdquo;, which hopefully means we can drive an LED directly from these pins without a need for a separate LED driver.</p>

<h3 id="turning-a-pin-on-and-off">Turning a Pin On and Off</h3>

<p>As a simple partial step, let&rsquo;s just try turning the LEDs on and off. I found plenty of ways how NOT to do this, but very few that worked correctly. This is where other keyboard code can serve as a great learning example. The software stack for STM32 processors is particularly complicated, because the chip actually runs its own embedded operating system called <a href="http://chibios.org/dokuwiki/doku.php">ChibiOS</a>. I initially had a lot of trouble determining if I should be looking for QMK, STM32, or ChibiOS documentation.</p>

<p>There are a few major things that must be done to get backlighting enabled:</p>

<ul>
<li>In <code>rules.mk</code>, add the line <code>BACKLIGHT_ENABLE = yes</code> to indicate you intend to use the backlight feature.</li>
<li>In <code>config.h</code>, add the line <code>#define BACKLIGHT_LEVELS 1</code>. For this example we will only be turning the LEDs completely on or completely off, so we define only a single level which represents &ldquo;on&rdquo; (the &ldquo;off&rdquo; level is implied).</li>

<li><p>We will need to define the behavior of toggling the backlight, so I created a source file called <code>led.c</code> in the folder for my keyboard (at the same level as <code>rules.mk</code>, <code>config.h</code>, etc.). There is some documentation on <a href="https://beta.docs.qmk.fm/for-makers-and-modders/internals_gpio_control">GPIO Controls</a> that will come in handy here. The contents of led.c are as follows:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&#34;dz65rgb.h&#34;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">backlight_init_ports</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
<span class="n">setPinOutput</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span> <span class="c1">// Use pin A
</span><span class="c1"></span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">backlight_set</span><span class="p">(</span><span class="n">uint8_t</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// Turn off the lights
</span><span class="c1"></span>		<span class="n">writePinLow</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// Turn on the lights
</span><span class="c1"></span>		<span class="n">writePinHigh</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div></li>

<li><p>There are a few things to note in the code above.</p>

<ul>
<li>Firstly, I included my keyboard&rsquo;s common header file which in turn includes <code>quantum.h</code>, which is necessary to provide the implementations of these special functions.</li>
<li>Also note, there is supposed to be another mechanism for defining the backlight pin, by setting for example <code>BACKLIGHT_PIN = B7</code> in <code>config.h</code> - however I could not get this to work specifically due to some preprocessor errors in ChibiOS, which is the OS used when running on an STM32 ARM processor. So to define the output pin, I had to reference it directly in the <code>backlight_init_ports()</code> and <code>backlight_set()</code> functions.</li>
<li>The functions <code>backlight_init_ports()</code> and <code>backlight_set()</code>are special - QMK knows to call these functions when pressing the corresponding backlight control keys.</li>
<li>The state of the pin will be remembered between keyboard boots, so if you turn the backlight on it will be on the next time you connect the keyboard, and if you turn it off it will remain off the next time you connect the keyboard</li>
<li>Finally as you can see, the backlight is either &ldquo;on&rdquo; or &ldquo;off&rdquo;, and any backlight level other than <code>0</code> will represent &ldquo;on&rdquo; at full brightness, which is why we chose to only have a single &ldquo;on&rdquo; backlight level in <code>config.h</code>.</li>
</ul></li>

<li><p>Back in <code>rules.mk</code> make sure to add <code>led.c</code> to your list of source files by adding the line <code>SRC += led.c</code>.</p></li>

<li><p>You have to map the <a href="https://beta.docs.qmk.fm/features/feature_backlight#keycodes">backlight keycodes</a> to control the backlight, so I created my own custom keymap. As a simple test, I just mapped <code>BL_TOGG</code> to <code>LAYER1</code>, where the <code>Z</code> key normally is on a keyboard. So pressing <code>FN + Z</code> should toggle the backlight pin on and off.</p></li>
</ul>

<p>With the modifications above, I was able to build a version of the QMK firmware that added my own custom keybinding to toggle a specific pin on my keyboard on and off, using the backlight functionality. I used a multimeter to validate pin <code>A1</code> was off by default, and after pressing the backlight toggle key, I measured that pin <code>A1</code> indeed turned on. Success!</p>




<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4787.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4787.jpg" alt="Multimeter for testing"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4787.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


</div>


<h2 id="dimmable-underglow">Dimmable Underglow</h2>

<h3 id="finding-dimmable-pwm-pins">Finding Dimmable (PWM) Pins</h3>

<p>In order to dim LEDs, we need to connect them to <a href="https://www.arduino.cc/en/Tutorial/PWM">PWM ports</a>. Since the PCB I have conveniently breaks out pins A1-A5, I took a look at which of those pins can be controlled by PWM. From <a href="https://www.st.com/en/microcontrollers-microprocessors/stm32f303.html">page 47 of the spec</a> I found the STM32F303 has alternate functions for the breakout pins which allow them to function as PWM pins, with the following mapping:</p>

<table>
<thead>
<tr>
<th align="left">Pin</th>
<th align="right">Timer</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">PA1</td>
<td align="right">TIM2_CH2 or the TIM15_CH1N <br/> (The inverse or &ldquo;not&rdquo; of TIM15_CH1)</td>
</tr>

<tr>
<td align="left">PA2</td>
<td align="right">TIM2_CH3 or TIM15_CH1</td>
</tr>

<tr>
<td align="left">PA3</td>
<td align="right">TIM2_CH4 or TIM15_CH2</td>
</tr>

<tr>
<td align="left">PA4</td>
<td align="right">TIM3_CH2</td>
</tr>

<tr>
<td align="left">PA5</td>
<td align="right">TIM2_CH1_ETR (this stands for external trigger, <br/> and is an input for a signal to trigger TIM2)</td>
</tr>
</tbody>
</table>

<p>I&rsquo;m in luck that virtually every pin broken out on my PCB has PWM capabilities! We could approach this a number of ways, but since these pins have high power output according to the spec, I decided to use a single pin to directly drive the 4 LEDs I&rsquo;ll be connecting. TIM2 is a 32 bit timer and TIM3 is a 16 bit timer (according to Section 3.17 on Page 23), both of which are totally overkill for LED dimming, but let&rsquo;s use what we have. TIM15 is not referenced in the QMK or ChibiOS config files, so I avoided using this timer. I later found out that TIM2 was already used for another feature (more on this later). So I settled on using Pin A4, configured as Timer 3 Channel 2. According to the spec, to use Pin A4 as TIM3_CH2 we need to initialize it with &ldquo;Alternate Function 2&rdquo;, so let&rsquo;s take a look at how to initialize the pin.</p>

<h3 id="writing-pwm-code">Writing PWM Code</h3>

<p>I&rsquo;d like to give credit to <a href="https://github.com/qmk/qmk_firmware/commits?author=jmdaly">jmdaly</a> who I believe authored the <a href="https://github.com/qmk/qmk_firmware/tree/master/keyboards/handwired/co60">co60</a> backlighting code that I used for reference when writing this backlighting code.</p>

<p>Below is the initialization code:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="n">PWMConfig</span> <span class="n">pwmCFG</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mh">0xFFFF</span><span class="p">,</span>                               <span class="c1">// PWM clock frequency
</span><span class="c1"></span>  <span class="mi">256</span><span class="p">,</span>                                  <span class="c1">// PWM period (in ticks) 1S (1/10kHz=0.1mS 0.1ms*10000 ticks=1S)
</span><span class="c1"></span>  <span class="nb">NULL</span><span class="p">,</span>                                 <span class="c1">// No Callback
</span><span class="c1"></span>  <span class="p">{</span>
      <span class="p">{</span><span class="n">PWM_OUTPUT_DISABLED</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>
      <span class="p">{</span><span class="n">PWM_OUTPUT_ACTIVE_HIGH</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>   <span class="c1">// Enable Channel 2
</span><span class="c1"></span>      <span class="p">{</span><span class="n">PWM_OUTPUT_DISABLED</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">},</span>
      <span class="p">{</span><span class="n">PWM_OUTPUT_DISABLED</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>
  <span class="p">},</span>
  <span class="mi">0</span><span class="p">,</span>                                    <span class="c1">// HW dependent
</span><span class="c1"></span>  <span class="mi">0</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">backlight_init_ports</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">palSetPadMode</span><span class="p">(</span><span class="n">GPIOA</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">PAL_MODE_ALTERNATE</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>   <span class="c1">// Initialize pin A4 in alt mode 2
</span><span class="c1"></span>  <span class="n">pwmStart</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PWMD3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pwmCFG</span><span class="p">);</span>                        <span class="c1">// Start the PWM driver on timer 3 using the PWM config
</span><span class="c1"></span>  <span class="n">backlight_set</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>                                 <span class="c1">// Initialize the backlights to &#34;off&#34;
</span><span class="c1"></span><span class="p">}</span></code></pre></div>
<p>The line <code>palSetPadMode(GPIOA, 4, PAL_MODE_ALTERNATE(2));</code> specifically initializes the pin in the mode necessary to access the timer. The line <code>pwmStart(&amp;PWMD3, &amp;pwmCFG);</code> starts the corresponding timer. Note the <code>pwmCFG</code> configuration which defines the duty cycle, and importantly also specifically activates channel 2 for this timer.</p>

<p>Next, let&rsquo;s look at how to set the levels. If you are familiar with Arduino programming, this is the same behavior as <a href="https://www.arduino.cc/reference/en/language/functions/analog-io/analogwrite/"><code>analogWrite()</code></a>.</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="k">static</span> <span class="n">uint16_t</span> <span class="nf">cie_lightness</span><span class="p">(</span><span class="n">uint16_t</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">5243</span><span class="p">)</span> <span class="c1">// if below 8% of max
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">v</span> <span class="o">/</span> <span class="mi">9</span><span class="p">;</span> <span class="c1">// same as dividing by 900%
</span><span class="c1"></span>  <span class="k">else</span> <span class="p">{</span>
    <span class="n">uint32_t</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(((</span><span class="n">uint32_t</span><span class="p">)</span> <span class="n">v</span> <span class="o">+</span> <span class="mi">10486</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10486</span> <span class="o">+</span> <span class="mh">0xFFFFUL</span><span class="p">);</span> <span class="c1">// add 16% of max and compare
</span><span class="c1"></span>    <span class="c1">// to get a useful result with integer division, we shift left in the expression above
</span><span class="c1"></span>    <span class="c1">// and revert what we&#39;ve done again after squaring.
</span><span class="c1"></span>    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mh">0xFFFFUL</span><span class="p">)</span> <span class="c1">// prevent overflow
</span><span class="c1"></span>      <span class="k">return</span> <span class="mh">0xFFFFU</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">uint16_t</span><span class="p">)</span> <span class="n">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">backlight_set</span><span class="p">(</span><span class="n">uint8_t</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">uint32_t</span> <span class="n">duty</span> <span class="o">=</span> <span class="p">(</span><span class="n">uint32_t</span><span class="p">)(</span><span class="n">cie_lightness</span><span class="p">(</span><span class="mh">0xFFFF</span> <span class="o">*</span> <span class="p">(</span><span class="n">uint32_t</span><span class="p">)</span> <span class="n">level</span> <span class="o">/</span> <span class="n">BACKLIGHT_LEVELS</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Turn backlight off
</span><span class="c1"></span>      <span class="c1">// Disable channel 2 on PWM3
</span><span class="c1"></span>      <span class="n">pwmDisableChannel</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PWMD3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Turn backlight on
</span><span class="c1"></span>    <span class="c1">// Enable channel 2 on PWM3
</span><span class="c1"></span>    <span class="n">pwmEnableChannel</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PWMD3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">PWM_FRACTION_TO_WIDTH</span><span class="p">(</span><span class="o">&amp;</span><span class="n">PWMD3</span><span class="p">,</span><span class="mh">0xFFFF</span><span class="p">,</span><span class="n">duty</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>Now let&rsquo;s enable PWM through configs.
Default configs are stored in <code>...\qmk_firmware\quantum\stm32</code>. Copy <code>mcuconf.h</code> and <code>halconf.h</code> into the directory for your keyboard, e.g. <code>...\qmk_firmware\keyboards\dztech\dz65rgb</code>.
In <code>halconf.h</code>, set the following: <code>#define HAL_USE_PWM                 TRUE</code>.
There are now errors about TIM2 also being used for ST. This is why I didn&rsquo;t use the other pins that ran off of TIM2.
In <code>mcuconf.h</code>, set the following: <code>#define STM32_PWM_USE_TIM2                  FALSE</code>. What&rsquo;s important here is that TIM3 is used for PWM, which is set by the following: <code>#define STM32_PWM_USE_TIM3                  TRUE</code>.</p>

<h3 id="binding-the-backlight-functionality-to-keys">Binding the Backlight Functionality to Keys</h3>

<p>Now we can set the additional backlight functionality in a custom keymap so we can control the backlight! The <a href="https://docs.qmk.fm/#/newbs_getting_started">Getting Started Guide</a> describes how to do this. Navigate to the keymaps folder (in my case this was <code>...\qmk_firmware\keyboards\dztech\dz65rgb\keymaps</code>). I created a copy of the <code>default</code> folder so I could customize the keymap, and named it <code>halogenica</code>. From the <a href="https://beta.docs.qmk.fm/features/feature_backlight">QMK Backlight Feature</a> page you can find the following table of related special commands to reference in <code>keymap.c</code>.</p>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="right">Function</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">BL_TOGG</td>
<td align="right">Turn the backlight on or off</td>
</tr>

<tr>
<td align="left">BL_STEP</td>
<td align="right">Cycle through backlight levels</td>
</tr>

<tr>
<td align="left">BL_ON</td>
<td align="right">Set the backlight to max brightness</td>
</tr>

<tr>
<td align="left">BL_OFF</td>
<td align="right">Turn the backlight off</td>
</tr>

<tr>
<td align="left">BL_INC</td>
<td align="right">Increase the backlight level</td>
</tr>

<tr>
<td align="left">BL_DEC</td>
<td align="right">Decrease the backlight level</td>
</tr>

<tr>
<td align="left">BL_BRTG</td>
<td align="right">Toggle backlight breathing</td>
</tr>
</tbody>
</table>

<p>You can also see from the following keymap code that I bound most of the backlight keys to Row 2 (so you press <code>Fn</code>+<code>Z</code> to toggle, etc.)</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="k">const</span> <span class="n">uint16_t</span> <span class="n">PROGMEM</span> <span class="n">keymaps</span><span class="p">[][</span><span class="n">MATRIX_ROWS</span><span class="p">][</span><span class="n">MATRIX_COLS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">_LAYER0</span><span class="p">]</span> <span class="o">=</span> <span class="n">LAYOUT_65_ansi</span><span class="p">(</span> <span class="cm">/* Base */</span>
            <span class="n">KC_GESC</span><span class="p">,</span>  <span class="n">KC_1</span><span class="p">,</span>     <span class="n">KC_2</span><span class="p">,</span>     <span class="n">KC_3</span><span class="p">,</span>     <span class="n">KC_4</span><span class="p">,</span>     <span class="n">KC_5</span><span class="p">,</span>     <span class="n">KC_6</span><span class="p">,</span>     <span class="n">KC_7</span><span class="p">,</span>     <span class="n">KC_8</span><span class="p">,</span>     <span class="n">KC_9</span><span class="p">,</span>     <span class="n">KC_0</span><span class="p">,</span>     <span class="n">KC_MINS</span><span class="p">,</span>  <span class="n">KC_EQL</span><span class="p">,</span>   <span class="n">KC_BSPC</span><span class="p">,</span>    <span class="n">KC_GRAVE</span><span class="p">,</span>\
            <span class="n">KC_TAB</span><span class="p">,</span>   <span class="n">KC_Q</span><span class="p">,</span>     <span class="n">KC_W</span><span class="p">,</span>     <span class="n">KC_E</span><span class="p">,</span>     <span class="n">KC_R</span><span class="p">,</span>     <span class="n">KC_T</span><span class="p">,</span>     <span class="n">KC_Y</span><span class="p">,</span>     <span class="n">KC_U</span><span class="p">,</span>     <span class="n">KC_I</span><span class="p">,</span>     <span class="n">KC_O</span><span class="p">,</span>     <span class="n">KC_P</span><span class="p">,</span>     <span class="n">KC_LBRC</span><span class="p">,</span>  <span class="n">KC_RBRC</span><span class="p">,</span>  <span class="n">KC_BSLASH</span><span class="p">,</span>  <span class="n">KC_DELETE</span><span class="p">,</span>\
            <span class="n">KC_CAPS</span><span class="p">,</span>  <span class="n">KC_A</span><span class="p">,</span>     <span class="n">KC_S</span><span class="p">,</span>     <span class="n">KC_D</span><span class="p">,</span>     <span class="n">KC_F</span><span class="p">,</span>     <span class="n">KC_G</span><span class="p">,</span>     <span class="n">KC_H</span><span class="p">,</span>     <span class="n">KC_J</span><span class="p">,</span>     <span class="n">KC_K</span><span class="p">,</span>     <span class="n">KC_L</span><span class="p">,</span>     <span class="n">KC_SCLN</span><span class="p">,</span>  <span class="n">KC_QUOT</span><span class="p">,</span>            <span class="n">KC_ENT</span><span class="p">,</span>     <span class="n">KC_PSCREEN</span><span class="p">,</span>\
            <span class="n">KC_LSFT</span><span class="p">,</span>  <span class="n">KC_Z</span><span class="p">,</span>     <span class="n">KC_X</span><span class="p">,</span>     <span class="n">KC_C</span><span class="p">,</span>     <span class="n">KC_V</span><span class="p">,</span>     <span class="n">KC_B</span><span class="p">,</span>     <span class="n">KC_N</span><span class="p">,</span>     <span class="n">KC_M</span><span class="p">,</span>     <span class="n">KC_COMM</span><span class="p">,</span>  <span class="n">KC_DOT</span><span class="p">,</span>   <span class="n">KC_SLSH</span><span class="p">,</span>  <span class="n">KC_RSFT</span><span class="p">,</span>            <span class="n">KC_UP</span><span class="p">,</span>      <span class="n">KC_PAUSE</span><span class="p">,</span>\
            <span class="n">KC_LCTL</span><span class="p">,</span>  <span class="n">KC_LGUI</span><span class="p">,</span>  <span class="n">KC_LALT</span><span class="p">,</span>                      <span class="n">KC_SPC</span><span class="p">,</span>                       <span class="n">KC_RALT</span><span class="p">,</span>  <span class="n">MO</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>    <span class="n">KC_RCTL</span><span class="p">,</span>  <span class="n">KC_LEFT</span><span class="p">,</span>            <span class="n">KC_DOWN</span><span class="p">,</span>    <span class="n">KC_RIGHT</span><span class="p">),</span>
        <span class="p">[</span><span class="n">_LAYER1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LAYOUT_65_ansi</span><span class="p">(</span> <span class="cm">/* FN */</span>
            <span class="n">KC_GESC</span><span class="p">,</span>  <span class="n">KC_F1</span><span class="p">,</span>    <span class="n">KC_F2</span><span class="p">,</span>    <span class="n">KC_F3</span><span class="p">,</span>    <span class="n">KC_F4</span><span class="p">,</span>    <span class="n">KC_F5</span><span class="p">,</span>    <span class="n">KC_F6</span><span class="p">,</span>    <span class="n">KC_F7</span><span class="p">,</span>    <span class="n">KC_F8</span><span class="p">,</span>    <span class="n">KC_F9</span><span class="p">,</span>    <span class="n">KC_F10</span><span class="p">,</span>   <span class="n">KC_F11</span><span class="p">,</span>   <span class="n">KC_F12</span><span class="p">,</span>   <span class="n">KC_DEL</span><span class="p">,</span>     <span class="n">KC_HOME</span><span class="p">,</span>\
            <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">RGB_TOG</span><span class="p">,</span>  <span class="n">RGB_MOD</span><span class="p">,</span>  <span class="n">RGB_HUI</span><span class="p">,</span>  <span class="n">RGB_HUD</span><span class="p">,</span>  <span class="n">RGB_SAI</span><span class="p">,</span>  <span class="n">RGB_SAD</span><span class="p">,</span>  <span class="n">RGB_VAI</span><span class="p">,</span>  <span class="n">RGB_VAD</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_PSCR</span><span class="p">,</span>  <span class="n">KC_SLCK</span><span class="p">,</span>  <span class="n">KC_PAUS</span><span class="p">,</span>  <span class="n">RESET</span><span class="p">,</span>      <span class="n">KC_PGUP</span><span class="p">,</span>\
            <span class="n">KC_CAPS</span><span class="p">,</span>  <span class="n">RGB_SPI</span><span class="p">,</span>  <span class="n">RGB_SPD</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>            <span class="n">EEP_RST</span><span class="p">,</span>    <span class="n">KC_PGDN</span><span class="p">,</span>\
            <span class="n">KC_LSFT</span><span class="p">,</span>  <span class="n">BL_TOGG</span><span class="p">,</span>  <span class="n">BL_OFF</span><span class="p">,</span>   <span class="n">BL_ON</span><span class="p">,</span>    <span class="n">BL_DEC</span><span class="p">,</span>   <span class="n">BL_INC</span><span class="p">,</span>   <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>            <span class="n">KC_VOLU</span><span class="p">,</span>    <span class="n">KC_MUTE</span><span class="p">,</span>\
            <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>                      <span class="n">KC_TRNS</span><span class="p">,</span>                      <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_TRNS</span><span class="p">,</span>  <span class="n">KC_MPRV</span><span class="p">,</span>            <span class="n">KC_VOLD</span><span class="p">,</span>    <span class="n">KC_MNXT</span><span class="p">),</span>
<span class="p">};</span></code></pre></div>
<p>Finally, you can use <code>make dztech\dz65rgb:halogenica</code> (or whatever your custom keymap name is) to buid the new firmware, and you can flash it with the QMK Toolbox just as before, being sure to select your new custom <code>.bin</code> file. For a full list of all code changes I&rsquo;ve made, take a look at my github branch of <a href="https://github.com/halogenica/qmk_firmware">QMK Firmware</a>.</p>

<h2 id="leds">LEDs</h2>

<p>The TADA68 has 4 small surface mount white LEDs for underglow; 2 on the left and 2 on the right side of the keyboard. My initial intent was to replace these LEDs and mount them internally. After some experimentation, I ended up switching to a different type of LED mounted externally, for a brighter and more uniform distribution of light. Let&rsquo;s walk through the different LED options that might best suit your application.</p>

<h3 id="led-underglow-properties">LED Underglow Properties</h3>

<p>The LEDs I rigged up have a few properties in common. Firstly, because the microcontroller in my keyboard operates on 3.3V and I&rsquo;m driving the LEDs from there, the LED circuit needs to be rated for 3.3V. I also decided to use a single color, not RGB LEDs. It should be possible to use an RGB LED, but since I knew I wanted a single color this simplified the number of pins needed to control the LED and I no longer have to worry about a protocol to choose a color. I also knew I did not need to make the LEDs individually addressible, so they will all be controlled uniformally; they will all share the exact same brightness level. This means that I should be able to use a single pin from the microcontroller to control all LEDs used for underglow.</p>

<h3 id="led-power">LED Power</h3>

<p>As I mentioned above, the LEDs are all tied to a single high power and the PWM code is only controlling that single pin. This means that the LEDs share the power output of that single channel from the microcontroller. If the LEDs are not bright enough for your application, perhaps the best way to get more power is to use a transistor as a switch and tap into the USB power directly. That is beyond the scope of this post, but fortunately I&rsquo;ll be writing another post on how to do this soon!</p>

<p>I highly suggest using a multimeter to verify the voltage output of where you are wiring your LEDs. You can also verify the current that the pin can deliver. In my case, I observed 20mA at ~3.9V. This is an important measurement because the voltage does not strictly match the voltage advertised, and it can be helpful to understand the available power delivery when selecting LEDs so you can predict the potential brightness. In my case, I had several LEDs available on hand and I was able to experiment with different resistor values to get the right brightness and power levels, but it&rsquo;s always best to measure and verify.</p>

<h3 id="traditional-leds">Traditional LEDs</h3>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/LED-banner.jpg" alt="Traditional LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/LED-banner.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>These LED are common in through hole applications and hobbiest electronics. However they are fairly large and awkward to mount on a flat surface with no through holes. Also because they&rsquo;re so directional (as all LEDs are), I was concerned that the brightness and light pattern would not be uniform if I wasn&rsquo;t able to get all the LEDs perfectly mounted. I decided to look for a different kind of LED that would be easier to mount.</p>

<h3 id="smd-leds">SMD LEDs</h3>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/smd_sizes_led.jpg" alt="SMD LEDs of various sizes"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/smd_sizes_led.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>These LEDs use an SMD package (Surface Mount Devices) and are extremely small. They are available in a wide variety of colors, and can be ordered with resistors packaged in that enable connecting them directly to a power source at either ~3V or ~9V.  They are also available pre-wired, or standalone which would require you to solder some extremely small wires on yourself. For this application, I would highly suggest getting the pre-wired kind of LEDs because it can be difficult to properly solder wires onto SMDs this small unless you&rsquo;re an experienced solderer. I purchased mine pre-wired from <a href="https://www.aliexpress.com/item/32839711206.html?spm=2114.12010615.8148356.2.36bb1fafUJv0QS">Aliexpress</a>.</p>

<p>To create the circuit for these LEDs I chose to add resistors in line. This may not be strictly necessary, but I was trying to make a robust solution and I didn&rsquo;t want the LEDs to burn out over time or for one LED to be brighter than another. This is also why I used a resistor for each individual LED instead of a single resistor for all LEDs. All electrical components can vary slightly, and even LEDs from the same batch may have a different internal voltage drop. Current will follow the path of least resistance, so if one of the LEDs has a slightly lower operating power (aka <code>Voltage Threshold</code>), it&rsquo;s possible a majority or all of the current will flow through that LED and the other LEDs will not turn on. To combat that, a resistor on each LED helps to normalize the resistance for each LED and get a more even power distribution, and therefore a more uniform brightness. You can find more information on <a href="https://electronics.stackexchange.com/questions/22291/why-exactly-cant-a-single-resistor-be-used-for-many-parallel-leds">StackExchange</a></p>

<p>Below you can see the test circuit, and how I soldered the particularly thin wires to the LEDs. The smaller blue component in the test circuit is a potentiometer, which I can tune to different resistance values. I chose resistors of 220 Ohms. Using this circuit I was able to verify the brightness at a given operating voltage and current and choose the right resistors for the circuit. To create the final circuit I first tried to mount components to a small protoboard. However even the protoboard was so thick I was unable to fit it underneath the the PCB. Instead I decided to use some female headers that I shorted together to connect all the resistors to the circuit, which has the additional benefit of being removable. The ground for all the LEDs were tied together and another small female molex connector plugs into ground.</p>




<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4789.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4789.jpg" alt="Test circuit with power supply set to 3.3V and potentiometer set to 220 Ohms"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4789.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4791.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4791.jpg" alt="Parts using female jumpers for removable LEDs and a thinner profile"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4791.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4793.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4793.jpg" alt="Solder wires onto the resistor, trim to size, and cover with heat shrink"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4793.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4792.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4792.jpg" alt="The protoboard with resistor are much taller than the risers, so we need something thinner"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4792.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4837.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4837.jpg" alt="The female jumper bridged together; it looks like a mess but it works"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4837.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4839.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4839.jpg" alt="Connectors fit into an empty space on the board with enough room to mount the PCB in the case"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4839.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


</div>


<p>Finally, I assembeled everything. To align the LEDs with the holes in the TADA68 case, the LEDs actually need to be aligned on top of existing components on the PCB (which is presumably why this feature was omitted from the DZ65RGB in the first place). To mount the LEDs, one of the simplest and most effective methods is simply hot glue. Most hot glue does not conduct electricity when cured, and therefore it can be used on top of existing components. It is cleanly removable if necessary, but strong enough to hold small LEDs in place. The trickiest part is getting a dab of glue in exactly the right spot, and getting the LED seated in the glue pointing in the right direction before it dries and hardens. To do this, I held the LED with tweezers in one hand, the glue gun in the other hand, and worked very quickly to mount them in under 10 seconds. Thankfully no harm is done if you don&rsquo;t get it right the first shot, it&rsquo;s very easy to peel the glue off and try again. I also wanted to make sure I didn&rsquo;t pinch any of the wires underneath the PCB, so I taped them in place out of the way. At first I tried electrical tape but it simply didn&rsquo;t hold. I then switched to masking tape which worked wonderfuly. The fully assembled board is below. I was happy with the brightness, however I was not happy with the very direct light source - it was not softly diffused and did not cover much desk area. It was frankly difficult to see from my default seating position so I continued investigating LEDs&hellip;</p>




<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4840.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4840.jpg" alt="The LEDs were hot glued in place - and the two on the right hand side of the PCB actually need to mount on top of the pins for the RGB LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4840.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5211.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5211.jpg" alt="The parts for assembly with the 4 individual LED solution"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5211.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5214.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5214.jpg" alt="The LED lighting effect with individual LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5214.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


</div>




<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4861.jpg" alt="The result of two individual LEDs at maximum brightness. There&#39;s non-uniform light distribution, light bleeding up top, and poor ambient lighting"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4861.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<h3 id="cob-led">COB LED</h3>



<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/COB_LED.jpg" alt="60 x 8mm COB LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/COB_LED.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<p>A recent LED invention is the <a href="https://www.digikey.com/en/articles/techzone/2016/aug/the-basics-of-chip-on-board-cob-leds">COB LED</a>, which stands for &ldquo;Chip On Board&rdquo; LED. Normally, an LED behaves like a single point light source. To give the appearance of an area light source, like a bar of light, we used to use LED strips with a diffusing piece of plastic. However this adds bulk to the LED, and the diffusers can only do so much to make the light uniform. The COB LED is different - it actually has several diodes in a single substrate, and the entire substrate illuminates fairly uniformally. This allows more interesting shapes and less bulk. One possible downside is that they are not available in a huge variety of colors, and by far white was the most popular at the time I purchased. I expect it&rsquo;s very possible to produce these LEDs in other colors, but they&rsquo;re just significantly less common in the form factor I was looking for.</p>

<p>After researching, I found that there are several standard sizes that closely fit notches on the sides of the TADA68 case. The 50x7mm package appeared to fit perfectly but the substrate does not fill the package surface area and unfortunately it is designed to run at 9V which I was unable to drive with the keyboard. Another common size is 60x8mm, which thankfully works on 3.3V, but unfortunately appears just a few millimeters too long for the case. I decided to order several from <a href="https://www.aliexpress.com/item/1000006624305.html?spm=a2g0s.9042311.0.0.fb414c4dE5wTuu">Aliexpress</a> (you can also find them on ebay, but I believe they&rsquo;re all sourced from China) to experiment with them. I chose the 1W cool white version.</p>

<p>I first attempted using the 9v LEDs that would natrually fit my case. Unfortunately, I wasn&rsquo;t able to get these to power with any significant brightness below 7V, so they were basically unusable. I then decided my best option would be to try to trim the 3.3V LEDs down to size. I carefully separated the layers of the LED with a pen knife, and peeled back the metal heatsink with some pliers. As you can see in the photos below, the yellow substrate is what emits a difuse light, the small dots inside are the actual diodes, and the copper tracks under the heatsink are the positive and negative lines. These copper lines actually run the whole length of the board, so it&rsquo;s actually possible to trim the board to size as long as you don&rsquo;t separate the yellow substrate from the board, and the LED will still be functional! I ended up trimming off the conductive pads, so to get to the copper lines I actually scraped the board away with a razor until the copper lines were exposed. I was able to then solder wires directly to these lines. I was using extremely thin <a href="https://www.aliexpress.com/item/4000065120586.html?spm=a2g0o.productlist.0.0.76af4021reLdQr">0.2mm magnet wire</a> which is very finicky and did not make a good connection. After attempting a few different ways of trimming the LED, I finally chose to leave one of the mounting holes untrimmed and I wrapped the magnet wire through the hole and around the outside of the board a few times to hold the wire in place. I then soldered the whole coil in place which made a better connection and gave it more strength.</p>

<p>In this case I did not use resistors, and perhaps I should have. Since the COB LEDs actually have several LEDs in parallel in the package, it seemed less likely that the LEDs were in danger of being mismatched and producing non-uniform brightness. I had also wired these LEDs directly to a power source when testing and found them to be much brighter and consume much more power than I was able to produce from the output pin on my microcontroller. Therefore I didn&rsquo;t think it was likely I would burn out the LED either. So in an effort to simplify everything, I just wired the LEDs directly to the pins on the PCB.</p>

<p>It was easy to run the thin magnet wires through the existing holes where the previous LEDs would shine through. However I was having trouble attaching the LED to the aluminum case. I first tried hot glue, but it had a very weak bond and it&rsquo;s also difficult to make a totally clean bond with hot glue because it&rsquo;s very stringy. A more permenant option would be epoxy, but I didn&rsquo;t want to risk any permenant damage to my case in the event I wanted to switch LEDs later. Thankfully I found that blu tack (poster tack) worked extremely well! It made a very tight bond, it could be removed and cleaned without much trouble, and it is completely concealed under the LED.</p>

<p>The final result was much brighter and much more uniform than the SMD LEDs. At full brightness, the underglow is extremely bright, and I tend to keep them between 20-40% brightness under normal use. They appear to dim uniformally, and don&rsquo;t produce any noticable heat. Their mounting location is perfect, and they are essentially impossible to see unless looking underneath the keyboard. I&rsquo;m extremely please with the results, and the final product looks professional and high quality.</p>




<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7039.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7039.jpg" alt="Disassembling COB LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7039.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7043.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7043.jpg" alt="COB LEDs can be trimmed like this and still be functional"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7043.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7063.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7063.jpg" alt="I routed the wires through the existing holes in the case, and stuck the COB LED on with blu tack adhesive putty"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7063.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7066.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7066.jpg" alt="Carefully soldering the thin wires in place"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7066.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7074.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7074.jpg" alt="The 60x8mm COB LEDs after trimming fit perfectly"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7074.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7052.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7052.jpg" alt="Connecting the LEDs to another PCB temporarily to visualize how they will look on the case"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7052.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


</div>




<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7057.jpg" alt="The new light distribution"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7057.jpg" itemprop="contentUrl"></a>
  </figure>
</div>


<h2 id="gallery">Gallery</h2>




<div class="gallery caption-position-bottom caption-effect-fade hover-effect-zoom hover-transition" itemscope itemtype="http://schema.org/ImageGallery">
	  
  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4768.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4768.jpg" alt="The very convenient available breakout pins"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4768.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4770.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4770.jpg" alt="The STM32F303 Microcontroller"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4770.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4772.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4772.jpg" alt="The logic area of the PCB"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4772.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4787.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4787.jpg" alt="Multimeter for testing"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4787.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4789.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4789.jpg" alt="Test circuit with power supply set to 3.3V and potentiometer set to 220 Ohms"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4789.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4790.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4790.jpg" alt="Parts for mounting LED resistors, but the protoboard was too thick"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4790.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4792.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4792.jpg" alt="The protoboard with resistor are much taller than the risers, so we need something thinner"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4792.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4791.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4791.jpg" alt="Parts using female jumpers for removable LEDs and a thinner profile"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4791.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4793.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4793.jpg" alt="Solder wires onto the resistor, trim to size, and cover with heat shrink"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4793.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4794.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4794.jpg" alt="Connect each LED to a resistor, and tie all negative lines to ground"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4794.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4795.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4795.jpg" alt="All components heatshrinked and all female jumpers bridged together for easy assembly"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4795.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4837.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4837.jpg" alt="The female jumper bridged together; it looks like a mess but it works"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4837.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4838.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4838.jpg" alt="Components connected to the board"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4838.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4839.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4839.jpg" alt="Connectors fit into an empty space on the board with enough room to mount the PCB in the case"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4839.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4840.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4840.jpg" alt="The LEDs were hot glued in place - and the two on the right hand side of the PCB actually need to mount on top of the pins for the RGB LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4840.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4841.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4841.jpg" alt="Pins were soldered using A4 for power and GND for ground"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4841.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4845.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4845.jpg" alt="/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4845.jpg"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4845.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4846.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4846.jpg" alt="Holding wires in place with electrical tape - this didn&#39;t work too well and came off immediately"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4846.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4861.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4861.jpg" alt="The result of two individual LEDs at maximum brightness. There&#39;s non-uniform light distribution, light bleeding up top, and poor ambient lighting"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_4861.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5211.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5211.jpg" alt="The parts for assembly with the 4 individual LED solution"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5211.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5212.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5212.jpg" alt="A handy tool to hold things in place while soldering"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5212.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5214.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5214.jpg" alt="The LED lighting effect with individual LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_5214.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7039.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7039.jpg" alt="Disassembling COB LEDs"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7039.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7043.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7043.jpg" alt="COB LEDs can be trimmed like this and still be functional"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7043.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7061.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7061.jpg" alt="Connecting the LEDs to another PCB temporarily to visualize how they will look on the case"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7061.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7052.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7052.jpg" alt="Connecting the LEDs to another PCB temporarily to visualize how they will look on the case"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7052.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7054.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7054.jpg" alt="Connecting the LEDs to another PCB temporarily to visualize how they will look on the case"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7054.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7058.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7058.jpg" alt="The old light distribution"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7058.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7057.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7057.jpg" alt="The new light distribution"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7057.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7063.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7063.jpg" alt="I routed the wires through the existing holes in the case, and stuck the COB LED on with blu tack adhesive putty"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7063.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7065.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7065.jpg" alt="I made the wires long enough to easily remove the PCB"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7065.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7066.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7066.jpg" alt="Carefully soldering the thin wires in place"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7066.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7070.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7070.jpg" alt="The underglow effect"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7070.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7071.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7071.jpg" alt="Looking directly at the COB LEDs at full brightness is excessively bright - don&#39;t look straight at them"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7071.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7072.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7072.jpg" alt="The top of the case with the PCB easily mounted"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7072.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7073.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7073.jpg" alt="The bottom of the case with the COB LEDs mounted"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7073.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7074.jpg');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7074.jpg" alt="The 60x8mm COB LEDs after trimming fit perfectly"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/IMG_7074.jpg" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/vscode.png');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/vscode.png" alt="Firmware Compiled"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/vscode.png" itemprop="contentUrl"></a>
  </figure>
</div>

  

<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img" style="background-image: url('https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/QMKToolbox.png');">
      <img itemprop="thumbnail" src="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/QMKToolbox.png" alt="Firmware Uploaded"/>
    </div>
    <a href="https://halogenica.net/img/hardware/adding-underglow-to-dz65rgb-and-qmk/QMKToolbox.png" itemprop="contentUrl"></a>
  </figure>
</div>



</div>

        
          <div class="blog-tags">
            
              <a href="https://halogenica.net/tags/hardware/">Hardware</a>&nbsp;
            
              <a href="https://halogenica.net/tags/microcontroller/">Microcontroller</a>&nbsp;
            
              <a href="https://halogenica.net/tags/keyboard/">Keyboard</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://halogenica.net/hardware/custom-keyboard-dz65rgb/" data-toggle="tooltip" data-placement="top" title="Custom Keyboard - DZ65RGB">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:michael.robert.romero@gmail.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/halogenica" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/halogenica" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://reddit.com/u/halogenica" title="Reddit">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-reddit-alien fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/halogenica" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://www.youtube.com/user/angelkatalyst" title="Youtube">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-youtube fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://itch.io/profile/halogenica" title="Itch.io">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-gamepad fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Michael Romero
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2019
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://halogenica.net">Halogenica</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.58.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://halogenica.net/js/main.js"></script>
<script src="https://halogenica.net/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://halogenica.net/js/load-photoswipe.js"></script>









    
  </body>
</html>

